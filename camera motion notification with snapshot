blueprint:
  name: Camera Motion Notification with Snapshot
  description: 'This automation blueprint creates a camera snapshot when motion or any binary sensor is triggered and sends a notification with the picture to a notify service (all devices, specific group, or individual device).
    '
  domain: automation
  input:
    binary_sensor:
      name: Motion/Event Sensor
      description: Entity representing motion detection or any state change (doorbell, motion sensor, etc.)
      selector:
        entity:
          domain: binary_sensor
    camera:
      name: Camera
      description: The camera which creates the snapshot
      selector:
        entity:
          domain: camera
    notify_target:
      name: Notification Target
      description: 'Select the notification service to use. This will show all available notify services in your Home Assistant instance.'
      selector:
        target:
          entity:
            - domain: notify
    notification_title:
      name: Notification Title
      description: 'Default: "Camera Alert"'
      default: Camera Alert
    notification_message:
      name: Notification message
      description: 'Default: "{{ binary_sensor_name }} detected activity"'
      default: '{{ binary_sensor_name }} detected activity'
    click_action:
      name: Tap to view dashboard
      description: 'Path to camera dashboard'
      default: '/lovelace/cameras'
    delay_start:
      name: Delay (Optional)
      description: Wait before creating camera snapshot
      default: 0.0
      selector:
        number:
          min: 0.0
          max: 60.0
          unit_of_measurement: seconds
          mode: slider
          step: 1.0
    mode:
      name: Mode
      description: The mode of the automation
      selector:
        select:
          options:
            - single
            - restart
            - queued
            - parallel
          mode: dropdown
      default: single
    throttle_time:
      name: Throttle time (Optional)
      description: Time to wait before the automation can trigger again
      default: 0.0
      selector:
        number:
          min: 0.0
          max: 300.0
          unit_of_measurement: seconds
          mode: slider
          step: 5.0
  source_url: https://gist.github.com/speedyspikes/e0fbf4514ae831f08ebd6ed1e71c8573
trigger:
  platform: state
  entity_id: !input 'binary_sensor'
  from: 'off'
  to: 'on'
variables:
  binary_sensor: !input 'binary_sensor'
  binary_sensor_name: '{{ states[binary_sensor].name }}'
  camera: !input 'camera'
  notify_target: !input 'notify_target'
  notification_title: !input 'notification_title'
  notification_message: !input 'notification_message'
  click_action: !input 'click_action'
  delay_start: !input 'delay_start'
  throttle_time: !input 'throttle_time'
  snapshot_create_file_path: /config/www/tmp/snapshot_{{ states[camera].object_id
    }}.jpg
  snapshot_access_file_path: '{{ snapshot_create_file_path | replace(''/config/www'',''/local'')
    }}'
mode: !input 'mode'
action:
- delay: '{{ delay_start }}'
- service: camera.snapshot
  entity_id: !input 'camera'
  data:
    filename: '{{ snapshot_create_file_path }}'
- service: notify.notify
  target: '{{ notify_target }}'
  data:
    title: '{{ notification_title }}'
    message: '{{ notification_message }}'
    data:
      image: '{{ snapshot_access_file_path }}'
      clickAction: '{{ click_action }}'
      attachment:
        url: '{{ snapshot_access_file_path }}'
        content_type: JPEG
- delay: '{{ throttle_time }}'
